<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Jeu de D√© V√©nitien üé≠</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Palatino', 'Georgia', serif;
            background: linear-gradient(135deg, #1a4d6d 0%, #8B4513 30%, #B8860B 70%, #CD853F 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(218,165,32,0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139,69,19,0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            background: linear-gradient(145deg, #FFF9E6 0%, #FFEFD5 50%, #FFE4B5 100%);
            border-radius: 25px;
            padding: 50px 40px;
            max-width: 700px;
            width: 100%;
            text-align: center;
            border: 4px solid #B8860B;
            box-shadow: 
                0 25px 80px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(255,255,255,0.8),
                0 0 0 8px rgba(184,134,11,0.2);
            position: relative;
            z-index: 1;
            margin: 20px auto;
        }

        .container::before {
            content: 'üé≠';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            background: #FFF9E6;
            padding: 10px 20px;
            border-radius: 50%;
            border: 3px solid #B8860B;
        }

        h1 { 
            color: #8B4513; 
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            font-style: italic;
        }

        input[type="password"] {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #B8860B;
            border-radius: 12px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.9);
            transition: all 0.3s;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: #CD853F;
            box-shadow: 0 0 10px rgba(205,133,63,0.3);
        }

        select, button { 
            width: 100%; 
            padding: 14px; 
            margin-bottom: 15px;
            border-radius: 12px;
            font-size: 1.05em;
            transition: all 0.3s;
        }

        select {
            border: 2px solid #B8860B;
            background: white;
            cursor: pointer;
        }

        select:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        button { 
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .player-block {
            padding: 20px; 
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,248,220,0.9) 100%);
            border-radius: 15px; 
            margin-bottom: 15px;
            border: 2px solid #DAA520;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .player-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .player-block h3 {
            color: #8B4513;
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        .coin-container { 
            margin: 30px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .coin {
            width: 140px; 
            height: 140px;
            font-size: 4em; 
            border: 6px solid #B8860B;
            border-radius: 20px;
            display: flex; 
            justify-content: center; 
            align-items: center;
            background: linear-gradient(145deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                inset 0 2px 5px rgba(255,255,255,0.5);
            font-weight: bold;
            color: #8B4513;
            position: relative;
        }

        .coin::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px dashed rgba(139,69,19,0.3);
            border-radius: 10px;
        }

        .flipping { 
            animation: flip 0.8s ease-in-out; 
        }

        @keyframes flip { 
            0% { transform: rotateY(0deg) rotateX(0deg); }
            25% { transform: rotateY(180deg) rotateX(90deg); }
            50% { transform: rotateY(360deg) rotateX(180deg); }
            75% { transform: rotateY(540deg) rotateX(270deg); }
            100% { transform: rotateY(720deg) rotateX(360deg); }
        }

        .win-msg {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            margin-top: 20px;
            border-radius: 15px;
            font-size: 1.3em;
            border: 3px solid #28a745;
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
            font-weight: bold;
            color: #155724;
        }

        .lose-msg {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            padding: 20px;
            margin-top: 20px;
            border-radius: 15px;
            font-size: 1.3em;
            border: 3px solid #dc3545;
            box-shadow: 0 5px 15px rgba(220,53,69,0.3);
            font-weight: bold;
            color: #721c24;
        }

        #errorMessage {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
            border: 2px solid #dc3545;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }

        .cheat-value {
            font-size: 1.5em;
            color: #8B4513;
            font-weight: bold;
        }

        .subtitle {
            color: #A0522D;
            font-style: italic;
            margin-bottom: 25px;
            font-size: 1.1em;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%) !important;
        }

        .btn-danger {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%) !important;
        }

        @media (max-width: 600px) {
            body {
                align-items: flex-start;
                padding: 10px;
            }
            
            .container { 
                padding: 30px 20px;
                margin: 10px auto;
                border-radius: 20px;
            }
            
            .container::before {
                font-size: 2em;
                top: -20px;
                padding: 8px 15px;
            }
            
            h1 { 
                font-size: 1.8em;
                margin-bottom: 20px;
            }
            
            .subtitle {
                font-size: 0.95em;
                margin-bottom: 20px;
            }
            
            .coin { 
                width: 110px; 
                height: 110px; 
                font-size: 3em;
            }
            
            .coin-container {
                margin: 20px 0;
            }
            
            .player-block {
                padding: 15px;
                margin-bottom: 12px;
            }
            
            .player-block h3 {
                font-size: 1.1em;
            }
            
            select, button {
                padding: 12px;
                font-size: 1em;
            }
            
            .win-msg, .lose-msg {
                font-size: 1.1em;
                padding: 15px;
            }
            
            input[type="password"] {
                padding: 12px;
                font-size: 1em;
            }
        }
    </style>
</head>

<body>
<div class="container">

    <!-- Page Connexion -->
    <div id="loginPage">
        <h1>üé≠ Carnaval de Venise</h1>
        <p class="subtitle">Entrez dans le myst√®re du jeu v√©nitien...</p>
        <input type="password" id="password" placeholder="üîë Mot de passe">
        <button onclick="login()">Entrer</button>
        <div id="errorMessage" style="display:none;">‚ùå Mot de passe incorrect</div>
    </div>

    <!-- Page Tricheur -->
    <div id="settingsPage" style="display:none;">
        <h1>‚öôÔ∏è Les Coulisses du Palais</h1>
        <p class="subtitle">Ajustez les probabilit√©s secr√®tes...</p>

        <div id="cheatControls"></div>

        <button onclick="goToGame()">Commencer la Partie</button>
        <button onclick="backToLogin()" class="btn-secondary">Retour</button>
    </div>

    <!-- Page du jeu -->
    <div id="gamePage" style="display:none;">
        <h1>üé≤ Le Pari V√©nitien</h1>
        <p class="subtitle">Chaque joueur choisit son num√©ro de la fortune</p>

        <div id="playersArea"></div>

        <button id="btnRoll" onclick="rollDice()">üé≤ Lancer le D√© d'Or</button>

        <button onclick="resetPlayers()" class="btn-danger">
            üîÑ Nouvelle Manche
        </button>

        <div class="coin-container">
            <div class="coin" id="coin">?</div>
        </div>

        <div id="winnerDisplay"></div>

        <button onclick="logout()" class="btn-secondary">Quitter le Palais</button>
    </div>

</div>

<script>

    /* ============================
        LOGIN
    ============================= */

    let cheatChances = [10,10,10,10,10,10]; // % par joueur

    function login() {
        const pwd = document.getElementById("password").value;
        const error = document.getElementById("errorMessage");

        error.style.display = "none";

        if (pwd === "lejeu") {
            show("gamePage");
        }
        else if (pwd === "tricheur") {
            show("settingsPage");
        }
        else {
            error.style.display = "block";
            setTimeout(() => {
                error.style.display = "none";
            }, 3000);
        }
    }

    function show(page) {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("settingsPage").style.display = "none";
        document.getElementById("gamePage").style.display = "none";
        document.getElementById(page).style.display = "block";
    }

    function goToGame() { show("gamePage"); }
    function backToLogin() { show("loginPage"); }
    function logout() { 
        resetPlayers();
        show("loginPage"); 
    }

    /* ============================
        UI TRICHEUR
    ============================= */

    function buildCheatUI() {
        const area = document.getElementById("cheatControls");
        area.innerHTML = "";

        cheatChances.forEach((val, i) => {
            area.innerHTML += `
                <div class="player-block">
                    <h3>üé≠ Joueur ${i+1}</h3>
                    <input type="range" min="0" max="100" value="${val}"
                           oninput="updateCheat(${i}, this.value)">
                    <p class="cheat-value"><span id="cheatVal${i}">${val}</span>%</p>
                </div>
            `;
        });
    }

    function updateCheat(index, val) {
        cheatChances[index] = Number(val);
        document.getElementById("cheatVal"+index).textContent = val;
    }

    buildCheatUI();

    /* ============================
        JOUEURS : choix
    ============================= */

    const playersArea = document.getElementById("playersArea");

    const players = [
        { name: "Doge Lorenzo", choice: null },
        { name: "Contessa Elena", choice: null },
        { name: "Marchese Marco", choice: null },
        { name: "Baronessa Sofia", choice: null },
        { name: "Conte Giovanni", choice: null },
        { name: "Duchessa Bianca", choice: null }
    ];

    const selectedFaces = new Set();

    function updateSelects() {
        document.querySelectorAll(".player-select").forEach(select => {
            const current = select.value;
            select.innerHTML = "";

            const emptyOption = document.createElement("option");
            emptyOption.value = "";
            emptyOption.textContent = "-- Choisir un num√©ro --";
            select.appendChild(emptyOption);

            for (let i = 1; i <= 6; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = i;

                if (selectedFaces.has(String(i)) && current != i)
                    option.disabled = true;

                select.appendChild(option);
            }
            select.value = current;
        });
    }

    function createPlayersUI() {
        playersArea.innerHTML = "";

        players.forEach((p, index) => {
            const div = document.createElement("div");
            div.className = "player-block";

            div.innerHTML = `
                <h3>üé≠ ${p.name}</h3>
                <select class="player-select" data-id="${index}">
                    <option value="">-- Choisir un num√©ro --</option>
                    <option value="1">1</option><option value="2">2</option>
                    <option value="3">3</option><option value="4">4</option>
                    <option value="5">5</option><option value="6">6</option>
                </select>
            `;

            playersArea.appendChild(div);
        });

        document.querySelectorAll(".player-select").forEach(select => {
            select.addEventListener("change", () => {
                const id = select.dataset.id;
                const value = select.value;

                if (players[id].choice) selectedFaces.delete(players[id].choice);
                if (value !== "") selectedFaces.add(value);

                players[id].choice = value;

                updateSelects();
            });
        });
    }

    createPlayersUI();

    /* ============================
        LANCER DE DE POND√âR√â
    ============================= */

    function weightedRoll() {
        let total = cheatChances.reduce((a,b)=>a+b,0);
        if (total === 0) return Math.floor(Math.random() * 6) + 1;
        
        let r = Math.random() * total;

        for (let i=0; i<6; i++) {
            if (r < cheatChances[i]) return i+1;
            r -= cheatChances[i];
        }
        return 6;
    }

    function rollDice() {
        const coin = document.getElementById("coin");
        const winnerDisplay = document.getElementById("winnerDisplay");
        const btnRoll = document.getElementById("btnRoll");

        // V√©rifier qu'au moins un joueur a fait un choix
        const hasChoices = players.some(p => p.choice !== null && p.choice !== "");
        if (!hasChoices) {
            winnerDisplay.innerHTML = `<div class="lose-msg">‚ö†Ô∏è Au moins un noble doit faire un pari !</div>`;
            setTimeout(() => {
                winnerDisplay.innerHTML = "";
            }, 3000);
            return;
        }

        btnRoll.disabled = true;
        coin.textContent = "?";
        winnerDisplay.innerHTML = "";
        coin.classList.add("flipping");

        const roll = weightedRoll();

        setTimeout(() => {
            coin.classList.remove("flipping");
            coin.textContent = roll;
            btnRoll.disabled = false;

            const winners = players.filter(p => p.choice == roll);

            if (winners.length === 0) {
                winnerDisplay.innerHTML = `<div class="lose-msg">üíî La fortune n'a souri √† personne ce soir...</div>`;
            } else {
                const winnerNames = winners.map(w => w.name).join(", ");
                winnerDisplay.innerHTML = `<div class="win-msg">üèÜ Victoire pour ${winnerNames} ! Le d√© d'or vous sourit !</div>`;
            }
        }, 800);
    }

    /* ============================
        RESET
    ============================= */

    function resetPlayers() {
        selectedFaces.clear();

        document.querySelectorAll(".player-select").forEach(select => {
            select.value = "";
        });

        players.forEach(p => p.choice = null);

        document.getElementById("coin").textContent = "?";
        document.getElementById("winnerDisplay").innerHTML = "";

        updateSelects();
    }

    // Permettre la connexion avec la touche Entr√©e
    document.addEventListener("DOMContentLoaded", () => {
        const passwordInput = document.getElementById("password");
        if (passwordInput) {
            passwordInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") login();
            });
        }
    });

</script>

</body>
</html>
